---
title: "言語処理系の基礎：プログラムはどのようにして実行されるか - コンパイラ，インタプリタの基礎" # 記事のタイトル
emoji: "✏️" # アイキャッチとして使われる絵文字（1 文字だけ）
type: "tech"
topics: ["言語処理系", "コンパイラ", "インタプリタ"]
published: false # 公開設定（false にすると下書き）
---

言語処理系の基礎的な知識をまとめました．

---

私たちはプログラムを記述する際，何かしらのプログラミング言語を用いてプログラムを記述します．プログラミング言語を選択する際に必ずと言っていいほど出てくる言葉が「コンパイラ型言語」，「インタプリタ型言語」だと思います．これらの言葉は実際には正しい表現ではなく，これが何故正しくないかを理解するには「**プログラミング言語で記述されたプログラムがどのようにコンピュータ上で解釈・実行されるか**」を理解する必要があります．

本記事では，「コンピュータとは」，「プログラムとは」という話から始まり，プログラミング言語で記述されたプログラムが実行される過程や，その過程で重要な役割を担う言語処理系についての基礎的な事項を解説します．その中で，「**『コンパイラ型言語』，『インタプリタ型言語』という表現が何故正しくないのか？どういう表現が正しいのか？**」について触れていきます．

筆者の理解度に基づく基礎的な事項についての解説なので，理解している人にとってはコンパイラやインタプリタの解説に至るまでが冗長だと思われるかもしれません．それに関しては暖かい目で見たいただけるとありがたいです．できる限り正確に書くことを心掛けましたが，もし，記事内に誤りや誤解を招く表現がある場合はすぐ訂正しますので，Twitter やコメントでご指摘いただけると幸いです．

## 対象読者

- プログラムを実行するときにコンピュータ内部で何が起きているのか分からない人
- 「言語処理系」，「コンパイラ型言語」，「インタプリタ型言語」という言葉を聞いたことがある人
- コンパイラ，インタプリタについてよく分かっていない人

**注意**：言語処理系の話と言っても，コンパイラ，インタプリタの実装に関わるような話はしません．というより，筆者の知識不足によりできません．あくまで，**プログラムが実行される過程の全体像を掴み，言語処理系，コンパイラ，インタプリタの基本的な概念の理解する**ことを目的としています．熟練者の方にとっては得られるものがない，もしくは少ないかもしれません．

## 本記事の目的

- プログラムが実行される際にコンピュータ内部で何が起きているかという全体像を理解する
- 「プログラミング言語」，「プログラム」，「言語処理系」の意味や関係を理解する
- 「コンパイラ型言語」，「インタプリタ型言語」という言葉の誤り，扱い方を理解する

---

## Overview

まず，ざっくり概要．

- プログラミング言語で記述されたプログラムを実行するには，プログラミング言語を解釈するためのソフトウェアが必要．このソフトウェアを「言語処理系」という．
- 言語処理系は，大別して「コンパイラ」，「インタプリタ」がある．
- プログラミング言語に「コンパイラ型言語」，「インタプリタ型言語」という分類があるのではなく，「その言語の代表的な言語処理系がコンパイラ，またはインタプリタである」ということ
  - 「C 言語はコンパイラ型言語である」ではなく，「C 言語の代表的な言語処理系はコンパイラである」が正しい
  - 「Python はインタプリタ型言語である」ではなく，「Python の代表的な言語処理系はインタプリタである」が正しい
- つまり，原理的には C 言語のインタプリタも作れるし，Python のコンパイラも作れる．

---

## コンピュータの役割：計算を高速に，大量に行う

まず，大前提として，コンピュータの役割とは何かを考える．それは以下に示したことである．

- **コンピュータの役割は，計算を高速に，大量に行うことである**

現在普及しているコンピュータでは，文書作成，動画編集，ブラウザを用いたネットサーフィン，数値計算，情報処理，データ処理など様々な用途で用いられる．コンピュータにはさまざまな形態があるが，デスクトップパソコン，ノートパソコン，スマートフォン，ゲーム機などが代表的なコンピュータである．現代社会に無くてはならない存在となっている．

ミクロな視点で見ると，これらはコンピュータにより実行される大量の計算により成り立っている．**コンピュータの役割は，計算を高速に，大量に行うこと**であり，その計算結果を利用することで文書作成，動画編集・配信など様々な機能が実現できるのである．

しかし，コンピュータは自律的に計算を行っている訳ではない．上記のような機能を実現するためには，人間が予めコンピュータに「計算させたいこと」を命令群として記述した「**プログラム**」が必要となる．つまり，人間がコンピュータに計算を実行させるためにはプログラムが必要であり，以下のような関係となる．

- 人間 🙍‍♂️：プログラムを記述 ---> プログラム 📄（命令群） ---> コンピュータ 💻：プログラムを実行

ここまでで，コンピュータが文書作成，動画編集など便利な機能を実現するためには，**人間がプログラムを記述し，それをコンピュータに読み込ませて実行する必要がある**，という人間，プログラム，コンピュータの 3 者の関係を大まかに把握した．ここからは，それらが実際にどう動いているのか，その仕組みについて見ていく．

## コンピュータとは，プログラムとは

「コンピュータがプログラムを読み込んで実行する」と一口に言っても，コンピュータがどんな部品から出来ていて，その部品がどうプログラムを処理しているのかを知らなければその正確な理解は得られない．ここでは，「コンピュータとは何か」，「プログラムとは何か」という疑問を紐解いていく．

### コンピュータの構成要素

まず，コンピュータについて見ていく．
コンピュータは，以下の太字で示した 5 つの装置で構成される．これらはまとめて「5 大装置」と呼ばれる．

- CPU
  - **制御装置**
  - **演算装置**
- **記憶装置**
  - 主記憶装置（「メインメモリ」，単に「メモリ」とも）
  - 補助記憶装置（HDD，SSD，CD-ROM，DVD-ROM など）
- **入力装置**
  - キーボード，マウス，スキャナなど
- **出力装置**
  - ターミナル，モニター，プリンターなど

![](https://www.it-shikaku.jp/kougi/e/5daisouchi.gif)

_コンピュータの構成要素_

（引用元：[it-shikaku.jp - コンピュータシステム - 3.コンピュータ構成要素 - 1.プロセッサ - 2.コンピュータの構成](https://www.it-shikaku.jp/top30.php?hidari=03-01-02.php&migi=km03-01.php)）

上記に示した要素の内，[先述した "コンピュータの役割"](#コンピュータの役割：計算を高速に，大量に行う) である「**計算を高速に，大量に行う**」に必要なのは，CPU と主記憶装置（以下，メモリと呼ぶ）である．特に，「計算」（例えば，「1 + 1」など）を行う役割を担うのは CPU である．

- **コンピュータの構成要素の内，計算を実行するのを担うものは CPU とメモリである**

ここからは CPU とメモリがどのように計算を実行するかを見ていく．

### コンピュータが計算を実行する過程：機械語，メモリ，CPU の役割

コンピュータが計算を実行する過程は以下である．

1. 機械語で記述されたプログラムをメモリ上に展開する
2. メモリ上のプログラムを CPU が読み込み，計算を実行し，計算結果をメモリに返す
3. 2 を繰り返し，CPU が最終的な計算結果がメモリに返す
4. メモリ上の計算結果を出力装置に表示する

プログラムをメモリ上に展開するのは OS の役割だが，OS や出力装置まで風呂敷を広げすぎると話がまとめられなくなるので，ここでは詳しく扱わない[^1]．解説の便宜上，プログラムがメモリ上に展開される部分についてはブラックボックスとして扱う．

[^1]: 特に OS はプログラムの実行において非常に重要な役割を果たす．気になる方は「OS メモリ管理 プログラム」とかで検索．

「**プログラミング言語で記述されたプログラムがどのようにコンピュータ上で解釈・実行されるか**」において重要なのは上記の過程の内 1 ~ 3 であるため，ここからはそれらに着目していく．1 ~ 3 の過程における主要な登場人物は，「機械語で記述されたプログラム」，「メモリ」，「CPU」 の 3 者である．

- コンピュータが計算を実行するのに必要なもの
  - 機械語で記述されたプログラム
  - メモリ
  - CPU

機械語で記述されたプログラムは，命令群が記述されたバイナリファイルである．メモリは，「バイナリファイルのままだと CPU がプログラムを読み込めないので，一度メモリという場所に展開して CPU がプログラムを読み取れるようにするための場所」である．要するに「メモリはプログラムと CPU の仲介者」くらいに考える．CPU は，メモリから読み込んだ機械語のプログラムを解釈し，計算を実行する．

これら 3 者の関係を簡単にまとめると以下のようになる．

- （人間 🙍‍♂️ --->）機械語で記述されたプログラム 📄 ---> メモリ：プログラムを展開 ---> CPU：メモリ上のプログラムを順次読み込み実行

（実際に人間が機械語のプログラムを書くことは無いが，ここでは便宜上そのように表現してしまっている．これについては後述する機械語の解説を参照．）

ここまででまだ解説をしていないのは「機械語」と「CPU」なので，ここからは両者の関係について見ていく．

### 機械語と CPU の関係：CPU は機械語を解釈・実行する

CPU が計算を実行するには「1 + 1 をしろ」など，何か外部から命令が必要である．コンピュータは命令されない限りは動かない．その命令を行う際の言語が「**機械語**」である．というより，**CPU は機械語で記述されたプログラムしか解釈・実行できない**．

これは，日本人が日本人に仕事を命令する際に日本語の文章が必要なように，人間がコンピュータ，つまり CPU に計算を命令する際にはそれ専用の言語，そしてその言語で記述された文章（プログラム）が必要なのと同じである．

（例えが分かりづらかったらごめんなさい．要するに，コンピュータに計算を実行させるにはそれ専用の手続きが必要なんだぞってことを言いたかったです．）

**機械語**とは，"プログラミング言語の 1 つ" で，0 と 1 が並んたビット列として表現される．機械語で記述されたプログラムは，0 と 1 が並んだバイナリファイルである．人間がコンピュータに何か計算をさせたい場合 --- 例えば，「1 + 1」という計算をさせたい場合，機械語で「1 + 1」（1 と 1 を足せ）を表す命令群を記述し[^2]，機械語で記述されたプログラムを作成し，それを（メモリに展開した後）CPU に読み込ませて計算させる，という手順が必要である．

[^2]: ここでは機械語で「1 + 1」をどう記述するかについては触れない．

- 機械語は 0 と 1 を並べたビット列

### 機械語は人間には読み書きしづらい：機械語，高級言語，言語処理系

[コンピュータが計算を実行する仕組み機械語，メモリ，CPU の役割](#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%8C%E8%A8%88%E7%AE%97%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF%EF%BC%9A%E6%A9%9F%E6%A2%B0%E8%AA%9E%EF%BC%8C%E3%83%A1%E3%83%A2%E3%83%AA%EF%BC%8Ccpu-%E3%81%AE%E5%BD%B9%E5%89%B2)という節の最後の方で少しだけ触れたが，実際に人間が機械語のプログラムを読み書きすることはあまり無い[^3]．機械語で記述されたプログラムは 0 と 1 を並べたビット列であるため，それ自体を読んでも何を命令しているのかが分かりにくく，人間が扱うには難しい．

[^3]: 私の了見が狭いのでめったなことは言えませんが，少なくとも私の趣味である Web 開発の文脈で機械語を使用する場面は今のところ見たことがないです．機械語を読み書きするお仕事（低レイヤーを扱うお仕事とか？）とかあるんでしょうか？

では，どうすれば人間が複雑なプログラムを記述することが出来るのか？そこで使われるのが，**人間にとって読み書きがしやすい**，C 言語や Python などの高級言語と呼ばれるプログラミング言語である．高級言語の特徴は，人間には読み書きしやすく，CPU はその命令を解釈し実行することができないことである．反対に，機械語は人間には読み書きしにくく，CPU は解釈・実行できる．

人間がコンピュータに何かしらの計算を実行させたいときは，人間が読み書きしやすい高級言語で記述されたプログラムを用意し，それを**機械語で記述されたプログラムに変換し**，最終的に CPU に読み込ませて目的の計算結果を得る，という流れが基本となる．高級言語 -> 機械語の変換には，「**言語処理系 language processor**」というソフトウェアを用いる．言語処理系は**高級言語から機械語への翻訳機**だと考えれば良い．言語処理系は，大別すると「コンパイラ」，「インタプリタ」に分かれるが，それらの中身については後々解説する．

（ようやく本題である「言語処理系」，「コンパイラ」，「インタプリタ」が出てきた！！）

**人間がコンピュータに計算を実行させる基本的な流れ**

1. 高級言語で記述されたプログラムを用意する
2. 1 のプログラムを，言語処理系を用いて機械語で記述されたプログラムに変換する
3. 2 の結果得られた，機械語で記述されたプログラムを CPU に読み込ませて目的の計算結果を得る

**言語処理系の分類**

- 言語処理系：高級言語から機械語へ変換する
  - コンパイラ
  - インタプリタ

ここまでの登場人物を以下にまとめてみる．

- 人間 🙍‍♂️ ---> 高級言語（C，Python など）で記述されたプログラム 📄 ---> 言語処理系：高級言語から機械語への変換 ---> 機械語で記述されたプログラム 📄 --->メモリ：プログラムを展開 ---> CPU：メモリ上のプログラムを順次読み込み実行

[前々節](#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%8C%E8%A8%88%E7%AE%97%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E4%BB%95%E7%B5%84%E3%81%BF%EF%BC%9A%E6%A9%9F%E6%A2%B0%E8%AA%9E%EF%BC%8C%E3%83%A1%E3%83%A2%E3%83%AA%EF%BC%8Ccpu-%E3%81%AE%E5%BD%B9%E5%89%B2)の最後で示したまとめ ↓ と比べると，「**プログラミング言語で記述されたプログラムがどのようにコンピュータ上で解釈・実行されるか**」についての解像度が大分上がってきたのではないだろうか．

- 人間 🙍‍♂️ ---> 機械語で記述されたプログラム 📄 ---> メモリ：プログラムを展開 ---> CPU：メモリ上のプログラムを順次読み込み実行

### 補足：プログラミング言語とその分類

プログラミング言語の分類について

#### プログラミング言語

コンパイルを解説する文章では，「プログラミング言語」と「機械語」が区別されることが多い．区別される時は大体「プログラミング言語＝高級言語」として扱われ，あたかも機械語がプログラミング言語とは別物であるような印象を受けることがある．

コンパイルなどを解説する際には文脈上区別して考えた方が分かりやすいこともあるが，正確には，**機械語もプログラミング言語の 1 つ**であり，C 言語や Python の仲間である．

ただし，機械語とそれ以外のプログラミング言語では絶対的な違いがあり，**CPU が直接理解できるのは機械語で記述されたプログラムのみ**であり，それ以外のプログラミング言語で記述されたプログラムは，言語処理系によって必ず機械語で記述されたプログラムに変換されてから実行される．

コンピュータに計算を実行させたければ，最終的に必ず機械語のプログラムに行き着くということである．

- 参考
  - [機械語（マシン語）とアセンブリ言語](http://ext-web.edu.sgu.ac.jp/koike/CA14/assembler.html)

#### プログラミング言語の分類：システムの階層構造による分類

「機械語と他の高級言語はよく区別されるが，正確にはどちらもプログラミング言語の 1 つだ」という説明をしたばかりで恐縮だが，実際にはこれらを区別するちゃんとした根拠がある．それが**システムの階層構造によるプログラミング言語の分類**である．手始めにその分類を以下に示す．

- システムの階層構造によるプログラミング言語の分類
  - 低級言語：機械語，アセンブリ言語
  - 高級言語：C，C++，Golang，Python，Ruby

プログラミング言語というくくりで見た時，機械語，アセンブリ言語（プログラミング言語と機械語の中間的な位置の言語，説明省略）といったハードウェア（CPU）に近い言語は「**低級言語**」，または「**低水準言語**」と呼ばれる．

一方，**記述の抽象度が高い**（機械語は抽象度が低い），人間にとって読みやすいプログラミング言語は「**高級言語**」，または「**高水準言語**」と呼ばれる．

これらの呼び方は，**システムの階層構造に由来する呼び方**であり，機械語などはハードウェア寄りに位置するという意味で「低級」，「低水準」（「低レベル」，「低レイヤ」という言葉もここから来ている），その対義語として「高級」，「高水準」という言葉が使われている．

- 参考
  - [Wikipedia - 低水準言語](https://ja.wikipedia.org/wiki/%E4%BD%8E%E6%B0%B4%E6%BA%96%E8%A8%80%E8%AA%9E)

#### 「機械語で記述されたプログラム」と「高級言語で記述されたプログラム」の違い

「プログラム」とはプログラミング言語で記述された命令群であると述べてきた．念の為解説しておくと，機械語で記述された命令群もプログラムであり，それ以外の C 言語や Python などの高級言語で記述された命令群もプログラムである．違いは，前者はバイナリファイルであり，後者はテキストファイルであるということである．どちらも「プログラム」であることに違いはない．

- 機械語で記述されたプログラム＝バイナリファイル
- 高級言語で記述されたプログラム＝テキストファイル

## 小まとめ

ここで，これまで解説してきた知識の整理と，本記事の目的がどこまで達成されているかを確認する．

### 知識の整理

これまで，「コンピュータとは」，「プログラムとは」について整理し，「**プログラミング言語で記述されたプログラムがどのようにコンピュータ上で解釈・実行されるか**」を理解することに努めてきた．ここで，これまで解説してきたことを整理すると，以下に集約される．

- 人間 🙍‍♂️ ---> 高級言語（C，Python など）で記述されたプログラム 📄 ---> 言語処理系：高級言語から機械語への変換 ---> 機械語で記述されたプログラム 📄 --->メモリ：プログラムを展開 ---> CPU：メモリ上のプログラムを順次読み込み実行

文章に直すと以下のようになる．

> 人間がコンピュータに目的の計算を実行させたいとき，まず，高級言語を用いて実行させたい命令群をプログラムとして記述する．次に，言語処理系を用いて高級言語で記述されたプログラムを機械語で記述されたプログラムに変換する．そして，機械語のプログラムをメモリに展開し，それを CPU に読み込ませて目的の計算結果を得る．

### 本記事の目的の達成度の確認

本記事の目的と照らし合わせながら，どこまで解説し，どこまで解説がなされていないかを確認しておく．本記事の目的は以下の 3 つであり，現段階では上 2 つまで解説した（つもりである）．

- [x] プログラムが実行される際にコンピュータ内部で何が起きているかという全体像を理解する
- [x] 「プログラミング言語」，「プログラム」，「言語処理系」の意味や関係を理解する
- [ ] 「コンパイラ型言語」，「インタプリタ型言語」という言葉の誤り，扱い方を理解する

これまで，プログラムが実行される過程において言語処理系の立ち位置がどのようなものかを確認した．言語処理系は高級言語から機械語への翻訳機であり，大別して「コンパイラ」，「インタプリタ」に分かれる，というところまでは解説したが，コンパイラやインタプリタが何者かまでは解説していない．これらについて理解出来なければ 3 つめの目的は達成できないので，ここからは言語処理系の中身の解説を行っていく．そして，本記事の冒頭で書いた「**『コンパイラ型言語』，『インタプリタ型言語』という表現が何故正しくないのか？どういう表現が正しいのか？**」という問いへ答えていく．

---

## 言語処理系とは

### コンパイラとインタプリタの共通点，相違点

### 分類

## hoge

## プログラミング言語とは何か

ここまでで，以下のような「コンピュータで計算を実行させる」までの流れを大まかに学んだ．

1. プログラミング言語でプログラムを記述し，
2. それをコンパイラによって機械語に変換し，
3. コンピュータに計算を実行させる

ここからはプログラムを記述するためのプログラミング言語に着目し，その詳細に入っていく．

### プログラミング言語の存在意義

- **プログラミング言語の存在意義は，効率的にプログラムを書き，コンピュータを上手に活用できるようにすることである**

コンピュータに計算を実行させるにはプログラムが必要である．プログラムは人間が記述する必要があるが，コンピュータが直接解釈・実行可能な機械語のプログラムを読み書きするのは人間にとって難しいということはこれまでに述べた．そこで，人間が扱いやすい形でプログラムを記述することを可能にするのがプログラミング言語である．

「**プログラミング言語**」は，コンピュータに対する命令群，つまりプログラムを記述するための人工言語の総称である．プログラムを記述することを「**プログラミング**」という．日本語，英語などの自然言語と同様，文法（構文規則や意味規則など）で定義される．プログラミング言語は，機械語と異なり，主に英語を用いて[^4]，人間にとって読み書きしやすいように定義される．

[^4]: Brainfuck や hoge など特殊な言語も存在するが，ソフトウェア開発に使われる言語は英語がほとんどである．全然関係ない話だけど英語ネイティブの人に取ってプログラムがどう見えてるのかとても気になる．

先述したが，プログラミング言語の存在意義は，人間が直接扱うには難しい機械語に代わり，より人間が扱いやすいプログラムを記述するための言語を提供することである．**人間と機械語を仲介してくれるようなイメージである**．最終的にコンピュータに計算を実行させるためには，プログラミング言語で記述されたプログラムを機械語のプログラムに落とし込む必要があることは忘れてはならない．

- 人間 <-> （書く）機械語で記述されたプログラム <-> コンピュータ
- 人間 <-> （書く）プログラミング言語で記述されたプログラム <-> 機械語で記述された命令 <-> コンピュータ

人間は，プログラミング言語の存在により，効率的にプログラムを記述することができ，コンピュータをより上手く活用できるようになる．

## 言語処理系とは何か

ここまでの説明では，プログラミング言語（高級言語）で記述されたプログラムは全てコンパイラを用いて機械語に変換・実行されるかのように説明してきたが，実際にはそう単純ではない．「プログラムを実行するためにコンパイラを用いて機械語に変換・実行する」というのは，プログラムを実行させるための方法の 1 つでしかない．これ以外にもプログラムを実行する方法はある．ここでは，プログラミング言語で記述されたプログラムの実行方式をいくつか列挙してみる．

### プログラミング言語とプログラムの実行方式

「プログラムを実行するためにコンパイラを用いて機械語に変換・実行する」以外にもプログラムを実行する方法はある．以下に，プログラミング言語で記述されたプログラムの実行方式をいくつか列挙してみる．

尚，（）内にプログラミング言語をいくつか示したが，これは「その言語の代表的な処理系がその実行方式に該当する」という意味．

- **コンパイラ**（C/C++）
  - プログラミング言語で記述されたプログラムをコンパイルし，機械語で記述されたプログラムに変換し，それを CPU で実行する
- **純粋なインタプリタ**（Lisp）
  - プログラミング言語で記述されたプログラムを解釈・実行する．
  - 「純粋」=「AST 以上に抽象化した中間コード（バイトコード）を持たない」
- **コンパイラ + バイトコードインタプリタ**（Python，Ruby など多くの高級言語）
  - プログラミング言語で記述されたプログラムをコンパイルし，バイトコード（中間コード）で記述されたプログラムに変換し，それを仮想マシン（バイトコードが機械語であるような仮想的なプロセッサ）で実行する
- **コンパイラ + バイトコードインタプリタ + JIT コンパイラ**（Java，C#，Python + Numba）
  - プログラミング言語で記述されたプログラムをコンパイルし，バイトコード（中間コード）で記述されたプログラムに変換する．バイトコードのプログラムを，以下の 2 通りの方法を（よしなに）使い分けて実行する．
    - （バイトコードインタプリタ）バイトコードのプログラムをバイトコードインタプリタで実行
    - （JIT コンパイラ）バイトコードのプログラムを機械語に変換し CPU で実行
- **JIT コンパイラ**（Julia）
  - プログラミング言語で記述されたプログラムが JIT コンパイラによって機械語に変換し実行する．
  - JIT コンパイルにかかる時間を除いて，非常に高速に動作する．

### バイトコードとネイティブコードの違い

以下 2 つを比較する．

- Java コンパイラによる Java ソースコードのコンパイル
- C/C++ コンパイラによる C/C++ ソースコードのコンパイル

上記 2 つのコンパイラ様式は以下のようになる．

- Java
  - Java ソースコード <--- Java コンパイラ ---> Java クラスファイル（Java バイトコード）
- C/C++
  - C/C++ ソースコード <--- C/C++ コンパイラ ---> 実行ファイル（ネイティブコード）

上記を見ると，Java が当初インタプリタ方式といわれたとはいえ，開発言語としては Perl などよりは C/C++ に近いものであることが分かる．ただし，**C/C++ などの言語で作成したソースコードは OS に依存するし，C/C++ コンパイラは特定のプロセッサ専用のコードを生成する**．結果として，C/C++ コンパイラで生成した実行ファイルはハードウェア（プロセッサ）とソフトウェア（オペレーティングシステム）の両方に依存することになる．これを「プラットフォーム依存」という．

それに対して Java は，特定のハードウェアやソフトウェアへの依存しないコード（Java バイトコード）を生成する．

### JIT コンパイラ

- **実行時コンパイラ，JIT コンパイラ** Just-In-Time Compiler，
  - ソフトウェアの実行時にコードのコンパイルを行い，実行速度の向上を図るコンパイラのこと（実行時にその都度コンパイルを行うコンパイラ）．
  - 通常のコンパイラは，ソースコード（あるいは中間コード）から対象 CPU の機械語（ネイティブコード）への変換を実行前に事前に行うが，これを JIT と対比して「事前コンパイラ（Ahead-Of-Time コンパイラ，AOT コンパイラ）と呼ぶ．

各種プログラミング言語で記述されたプログラムを実行する際の JIT コンパイラの立ち位置を見てみる．

- C/C++
  - ソースコード <---コンパイラ（AOT コンパイラ）---> ネイティブコード <---> メモリ <---> CPU
- Java
  - 通常
    - ソースコード（`hoge.java`） <---コンパイラ---> バイトコード（`hoge.class`） <---JVM（JIT コンパイラ）---> ネイティブコード <---> メモリ <---> CPU
  - JIT を使わないで実行
    - ソースコード <---コンパイラ---> バイトコード <---JVM---> インタプリタ <---> メモリ <---> CPU
    - オプションによって JIT コンパイラを使わずにインタプリタのみを用いて `.class` ファイルを実行できる．
- Python
  - ソースコード <---コンパイラ---> バイトコード <---Python VM による変換---> ネイティブコード <---> メモリ <---> CPU

参考

- [JIT コンパイラの実際の動作(2016)](https://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-MA16-JIT.pdf)

## 勘違い

- インタプリタは逐次機械語に翻訳とよく説明されているが，**機械語には翻訳されない**．中間コードに変換した後に仮想マシンに評価・実行される．

## インタプリタの利点

クライアント側の CPU に依存しないプログラムの実行環境．

## プログラミング言語と言語処理系

まず，「プログラミング言語で記述したプログラムを実行する」には，「**プログラミング言語**」自体と，そのプログミング言語を「実行するためのプログラム」が必要になる．この「実行するためのプログラム」のことを「**プログラミング言語処理系**」（単に，**言語処理系**と略されることが多い）．そして，実際にプログラムの実行を担うのは「**プロセッサ**」（簡単に言えばコンピュータ）である．

- プログラムを実行するために必要なもの
  - プログラミング言語
  - 言語処理系
  - プロセッサ（コンピュータ）

以上の項目を 1 つずつ説明していくが，本題から少し逸れてしまうためプロセッサについての説明を省く．

ここでは，プログラミング言語，言語処理系，これら 2 つが存在する目的を説明した後，各項目について説明していく．

### プログラミング言語と言語処理系の目的

まず，それぞれの目的をざっくりまとめる．

- プログラミング言語と言語処理系を利用する目的
  - プログラミング言語
    - **プログラミング言語により，コンピュータに計算させたい命令を「効率的に」記述できる**．
  - 言語処理系
    - **人間に分かる言語と計算機の「仲介」をする役割を担う**

上記のまとめを紐解いていく．

**プログラミング言語は，人間がプロセッサへ実行させたい命令（プログラムやソフトウェア）を，効率的に記述するために使われる**（プログラミング言語を利用することの利点は多くあるが，ここでは省く）．

プロセッサが計算を実行する際は，機械語（低級言語という）というプロセッサが直接解釈・実行可能な命令群が読み込まれ，実行される．**プロセッサは機械語で記述された命令でないと解釈・実行できない**．

読みにくい機械語と異なり，プログラミング言語は人間に読みやすい言語（高級言語という）であり，実行したい命令群を効率的に記述できる．ただし，**プロセッサにはプログラミング言語で書かれたプログラムは解釈・実行できない**．つまり，実行する段階で機械語に変換する

プロセッサにプログラムを実行させる前に，一度，機械語に変換する必要がある．この変換作業を行うのが言語処理系である．すなわち，**言語処理系は，人間に読みやすいプログラミング言語とプロセッサを仲介する役割を持つ**．

人間が解釈できるプログラミング言語で記述された命令群（プログラム） <-> 言語処理系 <-> プロセッサが解釈できる機械語で記述された命令群 <-> プロセッサ

![簡単な図を入れたい]

最後にここまでの話をまとめる．

- プログラミング言語と言語処理系を利用する目的
  - プログラミング言語
    - 機械語では，人間が実行させたい命令の読み書きがしにくい．
    - **プログラミング言語により，コンピュータに計算させたい命令を「効率的に」記述できる**．
    - ただし，プログラミング言語で記述されたままでは，直接コンピュータに実行させることができない．
  - 言語処理系
    - プログラミング言語で記述されたプログラムを機械語に変換し，プロセッサが実行できる形式にする．
    - **人間に分かる言語と計算機の「仲介」をする役割を担う**

以上の目的を理解した上で，プログラミング言語と言語処理系の説明に入る．

### プログラミング言語とは

まずはプログラミング言語について説明する．

- **プログラミング言語** programming language

  - プログラムを記述するための言語．形式言語の一つ．
  - 「プログラミング言語」，「プログラム言語」などと呼ばれる．

- **形式言語** formal language
  - 厳格な文法によって生成された言語．対義語は「自然言語」．
  - 一般に，形式言語は以下の 3 つの規則によって規定される．
    - **字句規則**
      - 識別子（予約語，関数名，変数名，など），演算記号，定数などの要素（[トークン token](#トークン)）の表記法を規定する．
    - **構文規則**
      - 式や文の形式を規定する（[式と文の違い](#式と文の違い)）．
    - **意味規則**
      - 構文の意味を規定する．

プログラミング言語（∈ 形式言語）は上記の 3 つの規則によって規定され，その仕様が決まり，「文法」．プログラミング言語の仕様に従って記述したものを「プログラム」，「ソースコード」という．

ここまででプログラムを書く準備は整った（実行する準備はできていない）．

参考

- [形式言語](http://home.a00.itscom.net/hatada/lp/formal-language/formal-language.html)

### 言語処理系とは

続いて，言語処理系について説明する．ざっくりと以下のように説明できる．

- 言語処理系
  - プログラムを解釈して実行するためのプログラム
  - プログラムを解釈して実行可能ファイルを生成するためのプログラム

しばしば，「プログラムを解釈して実行するためのプログラム」と説明されるが，代表的な言語処理系である**コンパイラは実行を担わないためこれには該当しない**ため，正確な意味を把握する際には注意が必要．

#### 言語処理系

- **言語処理系** language processor

  - 特定のプログラミング言語で記述されたプログラムを処理し，プロセッサ上で実行するためのソフトウエア．
  - 言語処理系，または，プログラミング言語処理系と呼ぶ．
  - プログラミング言語で書かれたプログラム（すなわちソースコード）を処理し，実行可能なプログラムコードへと変換する，または，処理した後何らかの操作を行うソフトウェア．
  - 大きく分けて「**コンパイラ**」，「**インタプリンタ**」，「**仮想マシン**」（JIT コンパイラ，Just In Time コンパイラ）．

#### コンパイラ

- **コンパイラ** compiler
  - 特定の言語を事前に他の言語のプログラムに変換するプログラム
  - 変換対象
    - 機械語：コンパイラ
    - 別のプログラミング言語：トランスパイラ，トランスレータ
  - コンパイラは一度に他の言語（機械語も含む）に変換するため，変更作業を結果に反映するのに時間がかかるが，変換後のコードは普通インタプリタより高速に実行できる．
  - コンパイラの例
    - **gcc**（GNU Compiler Collection）
      - 「GNU のコンパイラ群」の頭文字を取ったもの．
      - C，C++，Objective-C，Objective-C++，Fortran，Ada，Go，D 言語のコンパイラ，並びにこれらのライブラリが含まれている．
      - 言語によって名前が変わることもある．
        - GNU C Compiler: **GCC**（GNU Compier Collection と GNU C Compiler，両方で使われる）
        - GNU C++ Compiler: **G++**
        - GNU Compiler for Java: **GCJ**
    - **LLVM**
      - 任意のプログラミング言語に対応可能なコンパイラ基盤．名前の由来は開発初期に Low Level Virtual Machine (低水準仮想機械) の略として名づけられたが，今ではただの固有名詞として使われている．

#### インタプリタ

- **インタプリタ** interpreter
  - プログラムを逐次的に解析して実行するプログラムの総称．
  - プログラムを構文解析して得られた抽象構文木に対して解釈・実行を行うプログラムの総称
  - よく見る間違っている知識
    - 間違い ->「プログラムを一行ずつ解釈するプログラム」
    - 間違い ->「プログラムを一行ずつ機械語に変換するプログラム」
  - インタプリタ形式の言語処理系を用いるメリット
    - ソースコードの変更作業が容易で，試行錯誤のサイクルが回しやすい．
      - コンパイラのように最後まで変換するのを待ってから実行するのではなく，インタプリタが解釈と実行を逐次的に行うことで，素早くコード変更の結果を確認することができるためである．この性質から，**インタプリタを言語処理系として持つ言語がプロトタイプの作成に用いられることが多い**（スタートアップで Python，Ruby などが用いられる理由の一つ）．
      - しかし，愚直に逐次解析して実行している分，実行速度が遅くなるデメリットがある．

参考

- [言語処理系とは](http://www.hpcs.cs.tsukuba.ac.jp/~msato/lecture-note/comp2001/comp1/lecture1.htm)
- [言語処理系入門 1 ～言語処理系とは～（勉強メモ）](https://qiita.com/ogata-k/items/b4a2d0cbf90f246aca14)
- [プログラミング言語処理系の基礎](http://kmizu.github.io/hands-on/#/)

#### コンパイラとインタプリタの違い

プログラミング言語処理系には，コンパイラとインタプリタがあると説明してきたが，インタプリタは実行を行うが，コンパイラは実行を行わない，という違いがある．

#### 「コンパイラ型言語」と「インタプリタ型言語」という言葉の誤解

結論から言うと，

- **プログラミング言語に「コンパイラ型」と「インタプリタ型」があるのではない．単に，それぞれの言語の代表的な言語処理系の実装がコンパイラ，またはインタプリタであった，というだけで，原理的にどの言語についてもコンパイラ，インタプリタを作ることができる．**

これについて少し，細かく見てみる．

- 言語に備わった性質として「インタプリタ型・コンパイラ型」みたいなのが決まるわけではない．
- コンパイラ，インタプリタは言語の性質ではなく，言語処理系の性質にすぎない．
- インタプリタはそもそも（機械語や他の言語への）翻訳はしていない．ソースコードをパースして抽象構文木を組み立てて実行しているだけ．
- 例えば，C++ は一般に「コンパイラ型言語」だと言われているが，実際には，C++ のコンパイラ（gcc など）もあれば，C++ のインタプリタ，対話型インターフェイス（[root-project/cling](https://github.com/root-project/cling)）も存在する．

まとめると，プログラミング言語に「コンパイラ型」と「インタプリタ型」があるのではない．単に，**それぞれの言語の代表的な言語処理系の実装がコンパイラ（またはインタプリタ）であった**，というだけで，原理的にどの言語についてもコンパイラ，インタプリタを作ることができる．

誤解言語処理系として「コンパイラ」と「インタプリタ」（とそのハイブリッドな様々）があり，各言語で書かれたソースコードを実行するときに，「主にどちらの言語処理系に処理させるか」という話である．

一般に，C/C++ はコンパイラを利用して実行するため「コンパイラ型言語」，Python/Ruby などは主にインタプリタを利用して実行することが多いため「インタプリタ型言語」と呼ばれることが多々ある．言語によっては，コンパイルされることが前提となっている言語もある．

原理的には，C/C++ をインタプリタで実行できるし，Python をコンパイラでコンパイルすることもできる．

参考

- [Wikipedia - インタプリタ](https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%97%E3%83%AA%E3%82%BF#%E6%A6%82%E8%A6%81)

#### 言語処理系の典型的な処理の流れ

参考：[プログラミング言語処理系の典型的な処理の流れ](http://kmizu.github.io/hands-on/#/7)

1. （字句解析）
2. 構文解析
3. 意味解析
4. （中間コード生成）
5. （最適化）
6. コード生成（あるいは解釈・実行）

実際には行われないフェーズがあったり，書かれていないが行われるフェーズがたくさんある．所謂，構文エラー（syntax error），構文解析エラー（）

#### コンパイラの構成要素

コンパイラは主に 3 つの構成要素からなる．ここでは例として，gcc，LLVM を示す．

参考：[GNU コンパイラコレクション - 構成](https://ja.wikipedia.org/wiki/GNU%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3#%E6%A7%8B%E6%88%90)

##### gcc

- gcc
  - **フロントエンド部**
    - 字句解析，構文解析などを行う．
    - 対応言語ごとに用意されている．
      - C++: C++ フロントエンド
      - Java: Java フロントエンド
      - Go: Go フロントエンド（Go のコンパイラは主に 2 つあるが，その内「gccgo」は gcc のバックエンドに Go のフロントエンドを組み合わせたコンパイラ）
  - **オプティマイザ（最適化部）**
    - **全言語共通**
    - コードの最適化を行う．
  - **バックエンド部**
    - **全言語共通**
    - CPU 固有のコードを生成する（コードジェネレータ）．

フロントエンドやバックエンドを開発，追加することで，新しい言語やプロセッサ（CPU）に対応させることができる．標準のフロントエンド以外にも，Pascal や COBOL など様々な言語に対応したフロントエンド部が開発，公開されている．

##### LLVM

LLVM は正確にはコンパイラではなく「**コンパイラ基盤**」である．

コンパイラ基盤は，オプティマイザ，バックエンド部を合わせた部分である．つまり，中間言語の最適化処理や，様々な（CPU）アーキテクチャに対応したマシンコードの生成処理を行う部分である．

**フロントエンド部を実装すれば，基盤部分は再利用できるため，様々な言語に対応するコンパイラを作ることができる**．

- LLVM
  - **フロントエンド部**（解析フェーズ）
    - LLVM に共通する中間コードに変化する．
  - **オプティマイザ（最適化部）**（最適化フェーズ）
    - 中間コードの整形や生存解析などを行い，その中間コードをバックエンドに渡す．
  - **バックエンド部**（コード生成フェーズ）
    - 中間コードを受けとり，各アーキテクチャ（x86，x86-64 など）に応じた機械語を生成する．

![LLVM のアーキテクチャ](http://www.aosabook.org/images/llvm/RetargetableCompiler.png)

gcc 同様，各フェーズが独立しているため，新しい言語に対応したいときはフロントエンドだけ実装すれば良いし，新しいアーキテクチャに応じたコードを吐き出したいときはバックエンドだけ実装すれば良いため，LLVM は大変便利．最近の言語は LLVM 経由でコンパイラを実装していることがしばしばある．

参考

- [classmethod - LLVM とは](https://dev.classmethod.jp/articles/about_llvm/)
- [こわくない LLVM 入門!(2019)](https://qiita.com/Anko_9801/items/df4475fecbddd0d91ccc)
- [LLVM - The Architecture of Open Source Applications](http://www.aosabook.org/en/llvm.html)
- [雑把の仮想マシン（JVM, .NET, BEAM, スクリプト言語, LLVM）](http://yohshiy.blog.fc2.com/blog-entry-238.html)

### 構文エラー

参考：[情報システム用語辞典 | 構文エラー](https://www.itmedia.co.jp/im/articles/1111/07/news198.html)

言語処理系（Python の場合，インタプリタ）は上記の規定の実装である．以下の手順で，

1. 実行系ソースコード（文字列）を字句規則に添ってトークン列に変換する．
2. そこから構文規則に照らして構文木を作る．
3. 最終的に実行系を生成する．

3 の段階において，ソースコードに字句規則や構文規則から逸脱した表記が含まれていれば解析不能となり，コンパイル処理は中断される．当然，プログラムは実行できない．これが「構文エラー」である．

構文エラーは、主としてソースコードにおける記述ミスが原因で発生する。よくある例としては「単純なスペルミス」「カッコの閉じ忘れ」「カンマとコロンの取り違え」「変数名を宣言していない変数の使用」「引数の個数、データ型の間違い」「変数・定数名の二重定義」が挙げられる。

原理的には、コンパイラ型言語ではコンパイラがコンパイル段階で検出し、エラーを修正しない限り、コンパイルを完了できず、インタプリタ型言語（スクリプト言語）ではエラー個所まで実行し、そこで停止する――と説明できる。ただし、近年の統合開発環境にはコードの編集中に構文エラーを検出して修正を支援するものがあり、スクリプト言語には実行前に構文エラーを検出して、エラーメッセージを表示するものがある。

---

## 補足

各種基礎知識を補足としてまとめておく．

### 言語の分類

言語は，「自然言語」と「形式言語」の 2 つ大別される．

- 言語（参考：[形式言語構文と意味](http://home.a00.itscom.net/hatada/lp2016/chap02/formal-language.html)）
  - **自然言語** natural language
    - 日本語や英語など，自然に発生したため，厳密な文法に従っていない言語
  - **形式言語** formal language
    - プログラミング言語のように，厳格な文法によって生成された言語（C/C++，Python，Ruby など）

### 式と文の違い

**式は値を返すが，文は値を返さない**．ここでは，Python を例に示す．

#### 式は値を返す

例えば，print 関数や，リストの sort メソッドは，パッと見ると値を返していないように見えるが，正確には None を返している．

```python
>>> lis = [3, 1, 5]  # FIXME: 文だよ
>>> lis.sort()

# lis.sort() の戻り値を出力してみる
>>> print(lis.sort())
# None
# リストの sort メソッドが None を返していることが分かる

# print(lis.sort()) の戻り値を出力してみる
>>> print('print(lis.sort() の戻り値):', print('lis.sort() の戻り値:', lis.sort()))
# lis.sort() の戻り値: None
# print(lis.sort() の戻り値): None
```

#### 文は値を返さない

例えば，Python del 文は文なので，値を返さない．そのため，変数に代入できず，SyntaxError になる．

```python
>>> a = 'foo'
>>> del a  # 文が実行される．エラーは起きない．
>>> a = 'foo'
>>> b = del a  # 文を変数に代入しようとしている．エラーが起きる．
File "<ipython-input-8-54b1e435e69c>", line 1
  b = del a
      ^
SyntaxError: invalid syntax
```

### トークン

参考：[Wikipedia - 字句](https://ja.wikipedia.org/wiki/%E5%AD%97%E5%8F%A5)

- **トークン** token
  - プログラミング言語などにおいて，ソースコードに出現する文字列の中で意味を持つ最小単位のこと．
  - 「トークン」，「字句」ともいう（字句解析など）．
